<!DOCTYPE html>
<html lang="sl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TCS ng — Tedenske novice</title>

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Oswald:wght@400;500;600&display=swap"
      rel="stylesheet"
    />

    <style>
      :root {
        --font-body: "Inter", ui-sans-serif, system-ui, -apple-system, Segoe UI,
          Roboto, Arial, sans-serif;
        --font-head: "Oswald", "Inter", sans-serif;

        --text: rgba(255, 255, 255, 0.92);
        --muted: rgba(255, 255, 255, 0.72);
        --hairline: rgba(255, 255, 255, 0.14);

        --cta: rgba(255, 255, 255, 0.92);
        --cta-hover: rgba(255, 255, 255, 1);
        --cta-underline: rgba(255, 255, 255, 0.45);

        --max: 980px;
        --pad: 18px;
        --ease: cubic-bezier(0.2, 0.8, 0.2, 1);
      }

      * {
        box-sizing: border-box;
      }
      html,
      body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family: var(--font-body);
        color: var(--text);
        background: #0b0b10;
        scroll-behavior: smooth;
        overflow-x: hidden;
        text-rendering: optimizeLegibility;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }

      /* Background image (ista kot prva stran) */
      .bg {
        position: fixed;
        inset: 0;
        z-index: -2;
        background: linear-gradient(
            180deg,
            rgba(0, 0, 0, 0.22) 0%,
            rgba(0, 0, 0, 0.55) 58%,
            rgba(0, 0, 0, 0.78) 100%
          ),
          url("./TCS.jpg");
        background-size: cover;
        background-position: center;
        transform: scale(1.08);
        filter: blur(6px) contrast(1.02) saturate(1.25);
      }

      .grain {
        position: fixed;
        inset: 0;
        z-index: -1;
        pointer-events: none;
        opacity: 0.06;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='160' height='160'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.85' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='160' height='160' filter='url(%23n)' opacity='.55'/%3E%3C/svg%3E");
        mix-blend-mode: overlay;
      }

      header {
        position: sticky;
        top: 0;
        z-index: 50;
        padding: 14px var(--pad);
        transition: background 220ms var(--ease), border-color 220ms var(--ease);
        background: transparent;
        border-bottom: 1px solid transparent;
      }
      header.scrolled {
        background: rgba(0, 0, 0, 0.28);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      }

      .nav {
        max-width: var(--max);
        margin: 0 auto;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
      }

      .brand {
        display: flex;
        flex-direction: column;
        align-items: center;
        text-decoration: none;
        color: var(--text);
        line-height: 1.05;
      }

      .nav-logo {
        width: 26px;
        height: 26px;
        object-fit: contain;
        margin-bottom: 6px;
        opacity: 0.95;
      }

      .brand strong {
        font-family: var(--font-head);
        letter-spacing: 1px;
        text-transform: uppercase;
        font-size: 18px;
        font-weight: 600;
      }

      .brand span {
        font-size: 11px;
        color: var(--muted);
        letter-spacing: 0.4px;
        margin-top: 2px;
      }

      /* Text links (no boxes) */
      .nav a.link,
      .contact-lines a,
      .support a,
      .backlink a,
      .post details summary .readmore {
        color: var(--cta);
        text-decoration: none;
        font-weight: 600;
        letter-spacing: 0.15px;
        position: relative;
        padding: 6px 0;
        transition: color 180ms var(--ease), opacity 180ms var(--ease);
      }

      .nav a.link::after,
      .contact-lines a::after,
      .support a::after,
      .backlink a::after,
      .post details summary .readmore::after {
        content: "";
        position: absolute;
        left: 0;
        bottom: 2px;
        height: 1px;
        width: 100%;
        background: var(--cta-underline);
        transform: scaleX(0);
        transform-origin: left;
        transition: transform 180ms var(--ease), background 180ms var(--ease);
      }

      .nav a.link:hover,
      .contact-lines a:hover,
      .support a:hover,
      .backlink a:hover,
      .post details summary:hover .readmore {
        color: var(--cta-hover);
        opacity: 1;
      }

      .nav a.link:hover::after,
      .contact-lines a:hover::after,
      .support a:hover::after,
      .backlink a:hover::after,
      .post details summary:hover .readmore::after {
        transform: scaleX(1);
        background: rgba(255, 255, 255, 0.75);
      }

      main {
        max-width: var(--max);
        margin: 0 auto;
        padding: 54px var(--pad) 86px;
      }

      /* Novice header */
      .page-hero {
        min-height: calc(52vh - 86px);
        display: grid;
        place-items: center;
        text-align: center;
        padding-top: 18px;
      }

      .hero-inner {
        width: 100%;
        max-width: 820px;
        display: grid;
        justify-items: center;
        gap: 12px;
        opacity: 0;
        transform: translateY(12px);
        transition: opacity 700ms var(--ease), transform 700ms var(--ease);
      }
      .hero-inner.visible {
        opacity: 1;
        transform: translateY(0);
      }

      .title {
        font-family: var(--font-head);
        text-transform: uppercase;
        letter-spacing: 1px;
        font-weight: 600;
        font-size: clamp(28px, 4vw, 48px);
        line-height: 1.05;
        margin: 0;
      }

      .lead {
        max-width: 72ch;
        color: var(--muted);
        font-size: 16px;
        line-height: 1.8;
        margin: 0;
      }

      .rule {
        width: min(640px, 92vw);
        height: 1px;
        background: var(--hairline);
        margin: 18px 0 6px;
      }

      .backlink {
        margin-top: 6px;
        font-size: 14px;
        color: var(--muted);
      }

      /* Posts list */
      .posts {
        margin-top: 26px;
        display: grid;
        gap: 18px;
        justify-items: center;
      }

      #posts {
        width: 100%;
        display: grid;
        gap: 18px;
        justify-items: center;
      }

      .post {
        width: 100%;
        max-width: 860px;
        border-top: 1px solid var(--hairline);
        padding-top: 18px;
        opacity: 0;
        transform: translateY(14px);
        transition: opacity 650ms var(--ease), transform 650ms var(--ease);
      }
      .post.visible {
        opacity: 1;
        transform: translateY(0);
      }

      .post-grid {
        display: grid;
        grid-template-columns: 220px 1fr;
        gap: 16px;
        align-items: start;
      }

      .post-img {
        width: 100%;
        aspect-ratio: 4 / 3;
        border-radius: 14px;
        overflow: hidden;
        border: 1px solid rgba(255, 255, 255, 0.14);
        background: rgba(255, 255, 255, 0.04);
      }
      .post-img img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: block;
      }

      /* Sortbar */
      .sortbar {
        margin-top: 14px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        color: var(--muted);
        font-size: 14px;
      }
      .sortlabel {
        opacity: 0.9;
      }

      .sortselect {
        appearance: none;
        -webkit-appearance: none;
        -moz-appearance: none;
        background: rgba(255, 255, 255, 0.06);
        border: 1px solid rgba(255, 255, 255, 0.14);
        color: var(--text);
        border-radius: 12px;
        padding: 8px 12px;
        outline: none;
        cursor: pointer;
        transition: background 180ms var(--ease), border-color 180ms var(--ease);
      }
      .sortselect:hover {
        background: rgba(255, 255, 255, 0.09);
        border-color: rgba(255, 255, 255, 0.22);
      }

      /* title row: naslov + datum desno */
      .post-title-row {
        display: flex;
        align-items: baseline;
        justify-content: space-between;
        gap: 12px;
      }
      .post-title {
        margin: 0;
        font-family: var(--font-head);
        text-transform: uppercase;
        letter-spacing: 0.9px;
        font-weight: 600;
        font-size: 20px;
      }
      .post-date {
        color: rgba(255, 255, 255, 0.62);
        font-size: 13px;
        font-weight: 600;
        letter-spacing: 0.2px;
        white-space: nowrap;
      }

      .post-short {
        margin: 10px 0 0;
        color: var(--muted);
        line-height: 1.85;
        font-size: 15px;
      }

      /* “POMEMBNO” chip (čist tekst) */

      .badge {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        margin-top: 10px;

        font-size: 12px;
        font-weight: 800;
        letter-spacing: 0.6px;
        text-transform: uppercase;

        color: #0b0b10;
        background: #a79d91;

        padding: 6px 12px;
        border-radius: 999px;

        box-shadow: 0 0 0 1px rgba(167, 157, 145, 0.35),
          0 4px 14px rgba(167, 157, 145, 0.25);
      }

      .badge::before {
        content: "";
        width: 8px;
        height: 8px;
        border-radius: 999px;
        background: rgba(255, 255, 255, 0.75);
        box-shadow: 0 0 0 8px rgba(255, 255, 255, 0.06);
      }

      /* Read more (details/summary) */
      .post details {
        margin-top: 10px;
      }
      .post details summary {
        list-style: none;
        cursor: pointer;
        width: fit-content;
        margin: 0;
        outline: none;
        user-select: none;
      }
      .post details summary::-webkit-details-marker {
        display: none;
      }
      .post.important {
        border-top: 1px solid rgba(167, 157, 145, 0.6);
        box-shadow: 0 0 0 1px rgba(167, 157, 145, 0.25),
          0 10px 30px rgba(167, 157, 145, 0.15);
        border-radius: 18px;
        padding: 22px;
        background: rgba(167, 157, 145, 0.04);
      }

      .readmore {
        display: inline-flex;
        align-items: center;
        gap: 8px;
      }
      .chev {
        display: inline-block;
        transform: rotate(0deg);
        transition: transform 200ms var(--ease);
        opacity: 0.9;
      }
      details[open] .chev {
        transform: rotate(180deg);
      }

      .more p {
        margin: 0 0 10px;
        color: var(--muted);
        font-size: 14px;
        line-height: 1.85;
        max-width: 78ch;
      }
      .more p:last-child {
        margin-bottom: 0;
      }

      /* Shared sections at bottom (same style as first page) */
      section.bottom {
        padding-top: 40px;
        margin-top: 44px;
        border-top: 1px solid var(--hairline);
        display: grid;
        justify-items: center;
      }
      .section-inner {
        width: 100%;
        max-width: 860px;
        text-align: center;
        opacity: 0;
        transform: translateY(14px);
        transition: opacity 650ms var(--ease), transform 650ms var(--ease);
      }
      .section-inner.visible {
        opacity: 1;
        transform: translateY(0);
      }

      h2 {
        font-family: var(--font-head);
        text-transform: uppercase;
        letter-spacing: 0.9px;
        font-weight: 600;
        margin: 0 0 12px;
        font-size: 22px;
      }

      .contact-lines {
        margin-top: 14px;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 10px;
      }

      details.support {
        margin-top: 16px;
        width: 100%;
        max-width: 860px;
        text-align: center;
      }
      details.support summary {
        list-style: none;
        cursor: pointer;
        width: fit-content;
        margin: 0 auto;
        outline: none;
        user-select: none;
      }
      details.support summary::-webkit-details-marker {
        display: none;
      }
      .support-summary {
        display: inline-flex;
        align-items: center;
        gap: 10px;
        color: var(--cta);
        font-weight: 700;
        letter-spacing: 0.2px;
        padding: 6px 0;
        position: relative;
      }
      .support-summary::after {
        content: "";
        position: absolute;
        left: 0;
        bottom: 2px;
        height: 1px;
        width: 100%;
        background: var(--cta-underline);
        transform: scaleX(0);
        transform-origin: left;
        transition: transform 180ms var(--ease), background 180ms var(--ease);
      }
      details.support summary:hover .support-summary::after {
        transform: scaleX(1);
        background: rgba(255, 255, 255, 0.75);
      }
      details.support[open] .support-summary .chev {
        transform: rotate(180deg);
      }

      .support-content {
        margin-top: 14px;
        display: grid;
        gap: 10px;
        justify-items: center;
        padding-top: 8px;
      }
      .support-text {
        color: var(--muted);
        font-size: 14px;
        line-height: 1.75;
        max-width: 78ch;
      }
      .qr-wrap {
        width: min(240px, 70vw);
        aspect-ratio: 1 / 1;
        border-radius: 16px;
        border: 1px solid rgba(255, 255, 255, 0.18);
        background: rgba(255, 255, 255, 0.04);
        backdrop-filter: blur(6px);
        -webkit-backdrop-filter: blur(6px);
        display: grid;
        place-items: center;
        overflow: hidden;
      }
      .qr-wrap img {
        width: 100%;
        height: 100%;
        object-fit: contain;
        display: block;
      }
      .support a.donate-link {
        font-size: 16px;
        font-weight: 700;
      }

      footer {
        max-width: var(--max);
        margin: 0 auto;
        padding: 0 var(--pad) 28px;
        color: rgba(255, 255, 255, 0.55);
        font-size: 13px;
        text-align: center;
      }

      @media (max-width: 720px) {
        .post-grid {
          grid-template-columns: 1fr;
        }
        .post-img {
          max-width: 520px;
          margin: 0 auto;
        }
        .post-title-row {
          align-items: flex-start;
          flex-direction: column;
          gap: 6px;
        }
      }
      @media (max-width: 560px) {
        .brand span {
          display: none;
        }
        main {
          padding-top: 44px;
        }
      }
    </style>
  </head>

  <body>
    <div class="bg" aria-hidden="true"></div>
    <div class="grain" aria-hidden="true"></div>

    <header id="header">
      <nav class="nav">
        <a class="link" href="#kontakt" data-scroll>Kontakt</a>

        <a class="brand" href="./index.html" aria-label="TCS ng">
          <img class="nav-logo" src="./TCS logo BW.jpg" alt="TCS logo" />
          <strong>TCS ng</strong>
          <span>MTB skupnost</span>
        </a>

        <a class="link" href="#o-nas" data-scroll>O nas</a>
      </nav>
    </header>

    <main id="top">
      <section class="page-hero" aria-label="Tedenske novice">
        <div class="hero-inner" id="heroInner">
          <h1 class="title">Tedenske novice</h1>

          <div class="sortbar">
            <label for="sort" class="sortlabel">Razvrsti:</label>
            <select id="sort" class="sortselect">
              <option value="newest" selected>Najnovejše</option>
              <option value="oldest">Najstarejše</option>
            </select>
          </div>

          <p class="lead">
            Kratek pregled dogajanja, delovnih akcij in stanja poti. Klikni
            “Preberi več” za podrobnosti.
          </p>

          <div class="rule"></div>

          <div class="backlink">
            <a href="./index.html">← Nazaj na prvo stran</a>
          </div>
        </div>
      </section>

      <section class="posts" aria-label="Seznam novic">
        <div id="posts"></div>
      </section>

      <section class="bottom" id="o-nas">
        <div class="section-inner" id="aboutInner">
          <h2>O nas</h2>
          <p>
            Zgodba TCS ng se je začela pred več kot dvajsetimi leti, formalno pa
            smo se kot društvo povezali leta 2019. Naše poslanstvo je
            ohranjanje, gradnja in razvoj kakovostnih gorskokolesarskih poti v
            sodelovanju z naravo in lokalnim okoljem.
            <br /><br />
            Delujemo na območjih Skalnice, Sabotina, Škabrijela, Marka in širše,
            kjer čistimo opuščene poti ter gradimo enoslednice, ki zaradi
            naravnih danosti, razgledov in premišljene zasnove sodijo med
            najboljše v Sloveniji. Skupno je urejenih približno 40 kilometrov
            gorskokolesarskih poti, med njimi tudi legalna pot Škabrjelka na
            Škabrijelu.
          </p>
        </div>
      </section>

      <section class="bottom" id="kontakt">
        <div class="section-inner" id="contactInner">
          <h2>Kontakt</h2>
          <p>Za vprašanja, sodelovanja ali predloge:</p>

          <div class="contact-lines">
            <a class="link" href="mailto:info@tcs.bike">info@tcs.bike</a>
            <a class="link" href="tel:+38641705349">+386 41 705 349</a>
            <a class="link" href="#" onclick="return false;"
              >Instagram: @tcsng</a
            >
          </div>

          <details class="support">
            <summary>
              <span class="support-summary">
                Podpri nas <span class="chev">▾</span>
              </span>
            </summary>

            <div class="support-content">
              <div class="support-text">
                Če želiš podpreti urejanje in vzdrževanje poti, lahko doniraš
                preko QR kode ali povezave spodaj.
              </div>

              <div class="qr-wrap" aria-label="QR koda">
                <img src="./PodpriNasQR.jpg" alt="QR koda za donacijo" />
              </div>

              <a class="donate-link" href="#" onclick="return false;">
                Povezava za donacijo
              </a>
            </div>
          </details>
        </div>
      </section>
    </main>

    <footer>© <span id="year"></span> TCS ng • MTB skupnost</footer>

    <script>
      // Header: transparent at top, blurred/darker on scroll
      const header = document.getElementById("header");
      function updateHeader() {
        const y = window.scrollY || document.documentElement.scrollTop;
        header.classList.toggle("scrolled", y > 8);
      }
      window.addEventListener("scroll", updateHeader, { passive: true });
      updateHeader();

      // Smooth scroll with offset for sticky header
      document.querySelectorAll("[data-scroll]").forEach((a) => {
        a.addEventListener("click", (e) => {
          const href = a.getAttribute("href");
          if (!href || !href.startsWith("#")) return;
          const el = document.querySelector(href);
          if (!el) return;
          e.preventDefault();
          const y = el.getBoundingClientRect().top + window.scrollY - 80;
          window.scrollTo({ top: y, behavior: "smooth" });
        });
      });

      document.getElementById("year").textContent = new Date().getFullYear();

      /* ===============================
         POSTS: JSON + render + sort + pin
      ================================== */

      const postsContainer = document.getElementById("posts");
      const sortSelect = document.getElementById("sort");

      function formatDateSI(dateString) {
        const raw = String(dateString ?? "").trim();
        if (!raw) return "";

        // ISO
        const iso = raw.match(/^(\d{4})-(\d{2})-(\d{2})$/);
        if (iso) {
          const y = Number(iso[1]);
          const m = Number(iso[2]);
          const d = Number(iso[3]);
          return `${d}. ${m}. ${y}`;
        }

        // Slovenski
        const si = raw.match(/^(\d{1,2})\.\s*(\d{1,2})\.\s*(\d{4})$/);
        if (si) {
          return `${Number(si[1])}. ${Number(si[2])}. ${Number(si[3])}`;
        }

        // fallback
        return raw;
      }

      function escapeHTML(str) {
        return String(str ?? "")
          .replaceAll("&", "&amp;")
          .replaceAll("<", "&lt;")
          .replaceAll(">", "&gt;")
          .replaceAll('"', "&quot;")
          .replaceAll("'", "&#039;");
      }

      function longToHTML(longText) {
        const safe = escapeHTML(longText ?? "");
        const parts = safe.split(/\n\s*\n/g).filter(Boolean);
        if (!parts.length) return `<p> </p>`;
        return parts.map((p) => `<p>${p}</p>`).join("");
      }

      function toTime(p) {
        const raw = String(p?.date ?? "").trim();
        if (!raw) return 0;

        // ISO format: YYYY-MM-DD
        const iso = raw.match(/^(\d{4})-(\d{2})-(\d{2})$/);
        if (iso) {
          const y = Number(iso[1]);
          const m = Number(iso[2]);
          const d = Number(iso[3]);
          return new Date(y, m - 1, d).getTime();
        }

        // Slovenski format: D. M. YYYY ali D.M.YYYY
        const si = raw.match(/^(\d{1,2})\.\s*(\d{1,2})\.\s*(\d{4})$/);
        if (si) {
          const d = Number(si[1]);
          const m = Number(si[2]);
          const y = Number(si[3]);
          return new Date(y, m - 1, d).getTime();
        }

        return 0;
      }

      function sortWithPin(list, mode) {
        const dir = mode === "oldest" ? 1 : -1;

        const pinned = list.filter((p) => !!p.important);
        const normal = list.filter((p) => !p.important);

        pinned.sort((a, b) => (toTime(a) - toTime(b)) * dir);
        normal.sort((a, b) => (toTime(a) - toTime(b)) * dir);

        return [...pinned, ...normal];
      }

      function renderPosts(list) {
        postsContainer.innerHTML = "";

        if (!list.length) {
          postsContainer.innerHTML = `
            <div style="text-align:center; color: var(--muted); padding: 18px 0;">
              Trenutno ni objav.
            </div>
          `;
          return;
        }

        list.forEach((post, index) => {
          const article = document.createElement("article");

          const important = !!post.important;
          article.className = important ? "post important" : "post";

          const title = escapeHTML(post.title);
          const date = formatDateSI(post.date);
          const short = escapeHTML(post.short);
          const img = escapeHTML(post.image || post.img || "./TCS.jpg");
          const alt = escapeHTML(post.alt || post.title || "Novica");

          article.innerHTML = `
            <div class="post-grid">
              <div class="post-img">
                <img src="${img}" alt="${alt}" loading="lazy" />
              </div>

              <div>
                <div class="post-title-row">
                  <h3 class="post-title">${title}</h3>
                  <div class="post-date">${escapeHTML(date)}</div>
                </div>

                ${important ? `<div class="badge">POMEMBNO</div>` : ""}

                <p class="post-short">${short}</p>

                <details>
                  <summary>
                    <span class="readmore">
                      Preberi več <span class="chev">▾</span>
                    </span>
                  </summary>
                  <div class="more">
                    ${longToHTML(post.long)}
                  </div>
                </details>
              </div>
            </div>
          `;

          postsContainer.appendChild(article);

          // smooth reveal
          setTimeout(() => article.classList.add("visible"), index * 90);
        });
      }

      let cachedPosts = [];

      async function loadPosts() {
        try {
          const res = await fetch("./posts.json", { cache: "no-store" });
          if (!res.ok) throw new Error("Ne morem prebrati posts.json");

          const data = await res.json();
          cachedPosts = Array.isArray(data) ? data : [];

          const sorted = sortWithPin(
            [...cachedPosts],
            sortSelect?.value || "newest"
          );

          renderPosts(sorted);
        } catch (err) {
          postsContainer.innerHTML = `
            <div style="text-align:center; color: var(--muted); padding: 18px 0;">
              Ni mogoče naložiti novic. Preveri, če je <strong>posts.json</strong> v isti mapi kot HTML
              in da stran odpiraš prek <strong>http</strong> (Live Server), ne prek <strong>file://</strong>.
            </div>
          `;
          console.error(err);
        }
      }

      sortSelect?.addEventListener("change", () => {
        const sorted = sortWithPin([...cachedPosts], sortSelect.value);
        renderPosts(sorted);
      });

      loadPosts();

      /* ===============================
         Reveal animations (hero + bottom)
      ================================== */
      const reveal = (el) => el && el.classList.add("visible");
      const targets = [
        document.getElementById("heroInner"),
        document.getElementById("aboutInner"),
        document.getElementById("contactInner"),
      ].filter(Boolean);

      const io = new IntersectionObserver(
        (entries) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              reveal(entry.target);
              io.unobserve(entry.target);
            }
          });
        },
        { threshold: 0.12 }
      );
      targets.forEach((t) => io.observe(t));
    </script>
  </body>
</html>
